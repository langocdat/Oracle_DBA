--- Require: 
========== PRIMARY + STANDBY ================
1. alter database flashback on -->> enable flashback
2. Priamry + Standby: đã configure dataguard thủ công
3. Enable DG_BROKERE_START
    - (Sql): alter system set dg_broker_start=true scope=both;
    - (Sql): show parameter dg_brokere_start;
4. Configure tnsnames.ora và listener.ora

========== PRIMARY ============
  - (dgmgrl): create configuration 'my_dg' as primary database is 'orcl' connect identifier is 'orcl';
  - (dgmgrl): add database 'orclstd1' as connect identifier is 'orclstd1' maintained as physical;
  - (dgmgrl): enable configuration;

======== CHECK TRẠNG THÁI ===========
  - (dgmgrl):	SHOW CONFIGURATION;
  - (dgmgrl):	SHOW DATABASE ‘orcl’
  - (dgmgrl):	SHOW DATABASE ‘orclstd1’
  - (dgmgrl):SHOW DATABASE VERBOSE PRIMDB;
  - (dgmgrl):SHOW DATABASE VERBOSE STBYDB;

-	Thực hiện trên PrimaryDb 
DGMGRL>		ENABLE FAST_START FAILOVER;
			SET FAST_START FAILOVER TARGET =  ‘stand’
			SET FAST_START FAILOVER THRESHOLD = 30;
			SET FAST_START FAILOVER LAG_LIMIT= 30;
			SET FAST_START FAILOVER AUTO-REINSTATE = ON;
EDIT CONFIGURATION SET PROTECTION MODE AS MAXAVAILABILITY;
EDIT DATABASE 'orcl' SET Property FastStartFailoverTarget = 'stand';
EDIT DATABASE 'stand' SET Property FastStartFailoverTarget = 'orcl';
EDIT CONFIGURATION SET FASTSTARTFAILOVER THRESHOLD = 30;
EDIT CONFIGURATION SET FASTSTARTFAILOVER LAGLIMIT = 30;
EDIT CONFIGURATION SET FASTSTARTFAILOVER AUTOREINSTATE = ON;
-- Thiết lập đối tượng failover cho từng database
DGMGRL> EDIT DATABASE orcl SET PROPERTY FastStartFailoverTarget = 'stand';
DGMGRL> EDIT DATABASE stand SET PROPERTY FastStartFailoverTarget = 'orcl';
-- Đặt ngưỡng thời gian phát hiện lỗi (tính bằng giây)
DGMGRL> EDIT CONFIGURATION SET PROPERTY FastStartFailoverThreshold = 30;
-- Giới hạn độ trễ (tính bằng giây)
DGMGRL> EDIT CONFIGURATION SET PROPERTY FastStartFailoverLagLimit = 30;
-- Bật tự động phục hồi lại database khi nó khả dụng trở lại
DGMGRL> EDIT CONFIGURATION SET PROPERTY FastStartFailoverAutoReinstate = TRUE;
 
	Set mode truyen
DGMGRL> edit database orcl set property LogXptMode = SYNC;
Property "logxptmode" updated
	
Exception: Nếu lỗi, tắt tạm thời FSFO 
Dgmgrl>	DISABLE FAST_START FAILOVER;


Step 7: Install and run Observer
DGMGRL>	START OBSERVER;
DGMGRL>	SHOW OBSERVER;

Step 8: Check status
DGMGRL>	SHOW FAST_START FAILOVER;
DGMGRL> 	SHOW CONFIGURATION;
Kết quả mong muốn:
Fast-Start Failover: ENABLED
Observer Status     : Running


=====================================================================
||						DATAGUARD FOR RAC						   ||
=====================================================================

Check listener trong dgmgrl đối với RAC
(bash): dgmgrl /
(dgmgrl): show database verbose <db_name>
(dgmgrl): show instance verbose <instance_name>
Step 1: Dừng broker 
	(sql): ALTER SYSTEM SET dg_broker_start=FALSE SCOPE=BOTH;

Step 2: Attension: Phải kiểm tra file config dataguard đang nằm ở đâu?
	(sql): SHOW PARAMETER dg_broker_config_file1; Old Path way:  /u01/app/oracle/product/19c/dbhome_1/dbs/dr1orcl.dat
	(sql): SHOW PARAMETER dg_broker_config_file2; Old Path way:  /u01/app/oracle/product/19c/dbhome_1/dbs/dr1orc2.dat
	===>>> Cần phải đảm bảo chúng trỏ tới phân vùng chung để 2 instance đều đọc được. 
Trỏ địa chỉ mới
	(sql): ALTER SYSTEM SET dg_broker_config_file1 = '+DATA/ORCL/DATAGUARDCFG/dr1orcl.dat' SCOPE=SPFILE;
	(sql): ALTER SYSTEM SET dg_broker_config_file2 = '+DATA/ORCL/DATAGUARDCFG/dr2orcl.dat' SCOPE=SPFILE;

Step 3: Nếu đã có file cũ, cần phải copy file đấy sang phân vùng mới
	asmcmd cp /u01/app/oracle/product/19c/dbhome_1/dbs/dr1orcl.dat +DATA/ORCL/DATAGUARDCFG/dr1orcl.dat
	asmcmd cp /u01/app/oracle/product/19c/dbhome_1/dbs/dr2orcl.dat +DATA/ORCL/DATAGUARDCFG/dr2orcl.dat
Step 4: Enable configuration
	(sql): ALTER SYSTEM SET dg_broker_start = TRUE SCOPE = BOTH;

Step 5: Khởi động RAC
	srvctl stop database -d orcl
	srvctl start database -d orcl

---------------
Create new configuration
Step 1: 
	(sql): ALTER SYSTEM SET dg_broker_start = TRUE SCOPE = BOTH;
Step 2: 
	(sql): ALTER SYSTEM SET dg_broker_config_file1 = '+DATA/ORCL/DATAGUARDCFG/dr1orcl.dat' SCOPE=SPFILE;
	(sql): ALTER SYSTEM SET dg_broker_config_file2 = '+DATA/ORCL/DATAGUARDCFG/dr2orcl.dat' SCOPE=SPFILE;
Step 3: 
========== PRIMARY ============
  - (dgmgrl): create configuration 'my_dg' as primary database is 'orcl' connect identifier is 'orcl';
  - (dgmgrl): add database 'orclstd1' as connect identifier is 'orclstd1' maintained as physical;
  - (dgmgrl): enable configuration;


